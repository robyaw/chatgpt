<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Sonic Roll Bonus Stage</title>
  <style>
    body {
      font-family: Jost, Arial, sans-serif;
      text-align: center;
    }

    button {
      font-family: Jost, Arial, sans-serif;
      background: #33d;
      color: #fff;
    }

    button:hover {
      background: #44f;
    }

    .checkerboard {
      background:
        linear-gradient(45deg, #fb7 25%, transparent 25%, transparent 75%, #fb7 75%, #fb7),
        linear-gradient(45deg, #fb7 25%, transparent 25%, transparent 75%, #fb7 75%, #fb7);
      background-size: 120px 120px;
      background-position: 0 0, 60px 60px;
      /* half tile offset */
      background-color: #da9;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(4, 120px);
      grid-gap: 16px;
      justify-content: center;
      margin-top: 20px;
    }

    .tile {
      width: 120px;
      height: 120px;
      background: linear-gradient(to bottom, #FDB418, #FEE306);
      font-size: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: grab;
      border-radius: 10px;
      user-select: none;
      top: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
    }

    .tile:active {
      cursor: grabbing;
    }

    .tile.revealed {
      background: linear-gradient(to bottom, #fff3b0, #ffd6a5);
      cursor: default;
    }

    .tile.chaos {
      background: linear-gradient(to bottom, #fff, #ddd);
      cursor: default;
    }

    /* Show main icon + bonus icon stacked nicely */
    .stack {
      display: flex;
      flex-direction: column;
      gap: 6px;
      line-height: 1;
      position: relative;
    }

    .bonus {
      display: grid;
      position: absolute;
      right: -5px;
      top: -20px;
      font-size: 18px;
      background-color: #444;
      width: 25px;
      height: 25px;
      align-items: center;
      line-height: 1rem;
      border: 2px solid #ee0;
      border-radius: 2px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.7);
    }

    #status {
      margin-top: 20px;
      font-size: 24px;
      min-height: 24px;
    }

    .para-heading {
      position: relative;
      display: inline-block;
      padding: 0.25em 1.2em;
      font-size: 2rem;
      font-weight: 600;
      color: #fff;
      z-index: 0;
      text-transform: uppercase;
    }

    .para-heading::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, #d00, #d00);
      transform: skewX(-26deg);
      transform-origin: left center;
      z-index: -1;
    }


    button {
      margin-top: 15px;
      padding: 8px 16px;
      font-size: 14px;
    }

    .banner {
      background-color: #aaa;
      font-size: 12px;
      line-height: 1.5em;
      color: #fff;
      font-variant: italic;
      font-weight: bold;
      width: 120px;
    }
  </style>
</head>

<body class="checkerboard">

  <h1 class="para-heading">Sonic Roll Bonus Stage</h1>
  <p>Reveal ðŸ’Ž to get a Chaos Emerald. âšª gives another turn, ðŸ”´ ends your turn â€” also awards ðŸ“º, ðŸš€ or ðŸŸ¡.</p>

  <div id="grid"></div>
  <button id="status" onclick="startGame()">Reset Stage</button>

  <script>
    /**
     * Tile types:
     * - GOAL: win immediately (ðŸ’Ž)
     * - GO: another go (âšª) + bonus item
     * - END: end turn (ðŸ”´) + bonus item
     *
     * Bonus distribution:
     * BUMPER: 4 rings, 3 boosts
     * END: 2 boosts, 6 power-ups
     */

    let gameOver = false;

    function shuffle(arr) {
      // Fisher-Yates for a less-biased shuffle than sort(Math.random()-0.5)
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function makeTileDeck() {
      const deck = [];

      // 1 goal tile
      deck.push({ type: "GOAL", text: "CHAOS EMERALD" });

      // 7 BUMPER tiles: 4 rings, 3 boosts
      const goBonuses = shuffle([
        ...Array(4).fill("ðŸŸ¡"),
        ...Array(3).fill("ðŸš€"),
      ]);
      goBonuses.forEach(bonus => deck.push({ type: "GO", bonus }));

      // 8 END tiles: 2 boosts, 6 Power-Ups
      const endBonuses = shuffle([
        ...Array(2).fill("ðŸš€"),
        ...Array(6).fill("ðŸ“º"),
      ]);
      endBonuses.forEach(bonus => deck.push({ type: "END", bonus }));

      return shuffle(deck);
    }

    function setStatus(text) {
      document.getElementById("status").textContent = text;
    }

    function revealTile(tileEl, tileData) {
      tileEl.classList.add("revealed");

      if (tileData.type === "GOAL") {
        tileEl.classList.add("chaos");

        tileEl.innerHTML = `
    <div class="stack">
      <div class="main">ðŸ’Ž</div>
      <div class="banner">CHAOS EMERALD</div>
    </div>`;

        setStatus("Chaos Emerald Found! Reset Stage");
        gameOver = true;
        return;
      }

      const mainIcon = tileData.type === "GO" ? "âšª" : "ðŸ”´";

      tileEl.innerHTML = `
    <div class="stack">
      <div class="bonus">${tileData.bonus}</div>
      <div class="main">${mainIcon}</div>
    </div>
  `;
    }

    function startGame() {
      gameOver = false;
      setStatus("Reset Stage");

      const grid = document.getElementById("grid");
      grid.innerHTML = "";

      const deck = makeTileDeck();

      deck.forEach(tileData => {
        const tileEl = document.createElement("div");
        tileEl.className = "tile";
        tileEl.textContent = "ðŸ”µ"; // hidden state

        tileEl.addEventListener("click", () => {
          if (gameOver || tileEl.classList.contains("revealed")) return;
          revealTile(tileEl, tileData);
        });

        grid.appendChild(tileEl);
      });
    }

    startGame();
  </script>

</body>

</html>